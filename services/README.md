# Services æœåŠ¡ç›®å½•

è¿™ä¸ªç›®å½•åŒ…å«äº† Project Navi çš„æ‰€æœ‰åç«¯å¾®æœåŠ¡ï¼Œä½¿ç”¨ Python å’Œ Poetry è¿›è¡Œä¾èµ–ç®¡ç†ã€‚

## æœåŠ¡åˆ—è¡¨

### 1. ğŸ“¡ Scraper (é‡‡é›†æœåŠ¡)
**ç›®å½•:** `services/scraper`
**ç«¯å£:** N/A (å®šæ—¶ä»»åŠ¡)
**æè¿°:** ä»äº’è”ç½‘ä¸Šè‡ªåŠ¨æŠ“å–ç›¸å…³çš„èµ„è®¯ã€æ”»ç•¥ç­‰æ•°æ®

**åŠŸèƒ½:**
- æ–°é—»èµ„è®¯é‡‡é›†
- æ”»ç•¥å†…å®¹é‡‡é›†
- æ´»åŠ¨ä¿¡æ¯é‡‡é›†
- å®šæ—¶è°ƒåº¦æ‰§è¡Œ

---

### 2. ğŸ–¼ï¸ Image Processor (å›¾åƒå¤„ç†æœåŠ¡)
**ç›®å½•:** `services/image-processor`
**ç«¯å£:** 8000
**æè¿°:** æä¾›å›¾åƒå¤„ç†åŠŸèƒ½çš„å¾®æœåŠ¡

**åŠŸèƒ½:**
- å›¾åƒå‹ç¼©å’Œä¼˜åŒ–
- å›¾åƒè£å‰ªå’Œç¼©æ”¾
- æ ¼å¼è½¬æ¢
- æ°´å°æ·»åŠ 
- å›¾åƒä¿¡æ¯æå–

**API æ–‡æ¡£:** http://localhost:8000/docs

---

### 3. ğŸ¤– AI Analyzer (AI åˆ†ææœåŠ¡)
**ç›®å½•:** `services/ai-analyzer`
**ç«¯å£:** 8001
**æè¿°:** åŸºäº Claude API çš„ AI åˆ†ææœåŠ¡

**åŠŸèƒ½:**
- å†…å®¹æ‘˜è¦ç”Ÿæˆ
- è‡ªåŠ¨æ ‡ç­¾æå–
- å†…å®¹ç¿»è¯‘
- æƒ…æ„Ÿåˆ†æ
- å…³é”®è¯æå–
- å†…å®¹åˆ†ç±»

**API æ–‡æ¡£:** http://localhost:8001/docs

---

### 4. ğŸ›¡ï¸ Content Moderator (å†…å®¹å®¡æ ¸æœåŠ¡)
**ç›®å½•:** `services/content-moderator`
**ç«¯å£:** 8002
**æè¿°:** åŸºäº AI çš„å†…å®¹å®¡æ ¸æœåŠ¡

**åŠŸèƒ½:**
- è¯„è®ºå†…å®¹å®¡æ ¸
- æ•æ„Ÿè¯è¿‡æ»¤
- åƒåœ¾ä¿¡æ¯æ£€æµ‹
- è¿è§„å†…å®¹è¯†åˆ«
- å†…å®¹é£é™©è¯„åˆ†
- å¤šè¯­è¨€æ”¯æŒ

**API æ–‡æ¡£:** http://localhost:8002/docs

---

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.11+
- Poetry 1.7+

### å®‰è£… Poetry

```bash
curl -sSL https://install.python-poetry.org | python3 -
```

### å®‰è£…æœåŠ¡ä¾èµ–

æ¯ä¸ªæœåŠ¡éƒ½ç‹¬ç«‹ç®¡ç†ä¾èµ–ï¼š

```bash
# å®‰è£…é‡‡é›†æœåŠ¡ä¾èµ–
cd services/scraper
poetry install

# å®‰è£…å›¾åƒå¤„ç†æœåŠ¡ä¾èµ–
cd services/image-processor
poetry install

# å®‰è£… AI åˆ†ææœåŠ¡ä¾èµ–
cd services/ai-analyzer
poetry install

# å®‰è£…å†…å®¹å®¡æ ¸æœåŠ¡ä¾èµ–
cd services/content-moderator
poetry install
```

### ç¯å¢ƒé…ç½®

æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦é…ç½® `.env` æ–‡ä»¶ï¼Œå‚è€ƒå„æœåŠ¡ç›®å½•ä¸‹çš„ `.env.example` æ–‡ä»¶ã€‚

### è¿è¡ŒæœåŠ¡

```bash
# è¿è¡Œé‡‡é›†æœåŠ¡ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
cd services/scraper
poetry run python src/scraper/main.py

# è¿è¡Œå›¾åƒå¤„ç†æœåŠ¡
cd services/image-processor
poetry run uvicorn src.image_processor.main:app --reload

# è¿è¡Œ AI åˆ†ææœåŠ¡
cd services/ai-analyzer
poetry run uvicorn src.ai_analyzer.main:app --reload --port 8001

# è¿è¡Œå†…å®¹å®¡æ ¸æœåŠ¡
cd services/content-moderator
poetry run uvicorn src.content_moderator.main:app --reload --port 8002
```

## æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Project Navi                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Next.js  â”‚      â”‚    Expo    â”‚      â”‚  Services  â”‚  â”‚
â”‚  â”‚  (Admin)   â”‚â—„â”€â”€â”€â”€â–ºâ”‚  (Mobile)  â”‚â—„â”€â”€â”€â”€â–ºâ”‚  (Python)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚                    â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                             â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                       â”‚   tRPC API  â”‚                     â”‚
â”‚                       â”‚  (@acme/api)â”‚                     â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                              â”‚                             â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                       â”‚   Supabase  â”‚                     â”‚
â”‚                       â”‚ (PostgreSQL)â”‚                     â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æµ

### å†™å…¥æµç¨‹
```
äº’è”ç½‘æ•°æ® â†’ Scraper â†’ Supabase
ç”¨æˆ·ä¸Šä¼  â†’ Next.js Admin â†’ tRPC API â†’ Supabase
```

### è¯»å–æµç¨‹
```
Supabase â†’ tRPC API â†’ Next.js/Expo App
```

### å¤„ç†æµç¨‹
```
ç”¨æˆ·å†…å®¹ â†’ AI Analyzer (åˆ†æ/æ‘˜è¦) â†’ Supabase
ç”¨æˆ·è¯„è®º â†’ Content Moderator (å®¡æ ¸) â†’ Supabase
ç”¨æˆ·å›¾ç‰‡ â†’ Image Processor (å¤„ç†) â†’ Storage
```

## å¼€å‘è§„èŒƒ

### ä»£ç æ ¼å¼åŒ–
æ‰€æœ‰æœåŠ¡ä½¿ç”¨ Black å’Œ Ruff è¿›è¡Œä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥ï¼š

```bash
poetry run black .
poetry run ruff check .
```

### ç±»å‹æ£€æŸ¥
ä½¿ç”¨ MyPy è¿›è¡Œç±»å‹æ£€æŸ¥ï¼š

```bash
poetry run mypy .
```

### æµ‹è¯•
ä½¿ç”¨ Pytest è¿›è¡Œæµ‹è¯•ï¼š

```bash
poetry run pytest
```

## éƒ¨ç½²

æ¨èä½¿ç”¨ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ã€‚ç›¸å…³ Dockerfile å°†åœ¨åç»­æ·»åŠ ã€‚
